---
import Sidebar from '../components/dashboard/Sidebar.astro';
import '../styles/global.css';
import { API_URL } from '../config/api';

interface Props {
  title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{title}</title>
    <script define:vars={{ apiUrl: API_URL }}>
      window.API_URL = apiUrl;
    </script>
  </head>
  <body class="bg-background-subtle min-h-screen">
    <Sidebar />
    
    <div class="md:ml-64 min-h-screen flex flex-col">
      <header class="bg-white border-b border-slate-100 py-4 px-6 md:hidden sticky top-0 z-30 flex justify-between items-center">
        <img src="/Sergio.png" alt="Sergio Nolasco" class="h-8 w-auto" />
        <button id="mobileMenuBtn" class="text-slate-600">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </header>
      
      <main class="flex-1 p-6 md:p-12 max-w-7xl mx-auto w-full">
        <slot />
      </main>
    </div>

    <!-- Mobile Menu Overlay (Simplified) -->
    <div id="mobileMenu" class="fixed inset-0 bg-black/50 z-50 hidden md:hidden">
      <div class="bg-white w-64 h-full overflow-y-auto">
        <!-- Reusing Sidebar content logic via JS or duplication for simplicity in first pass -->
         <div class="p-6">
           <div class="flex justify-between items-center mb-8">
             <img src="/Sergio.png" alt="Sergio Nolasco" class="h-8 w-auto" />
             <button id="closeMenuBtn" class="text-slate-400">
               <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
               </svg>
             </button>
           </div>
           <!-- Content injected by JS or hardcoded for now -->
           <p class="text-sm text-slate-500">Menú móvil en construcción...</p>
           <a href="/logout" class="block mt-4 text-red-500 font-medium">Cerrar Sesión</a>
         </div>
      </div>
    </div>
  </body>
</html>

<script>
  // Simple auth check
  async function checkAuth() {
    try {
      const response = await fetch(`${window.API_URL}/users/me`, {
        credentials: 'include',
      });
      if (!response.ok) window.location.href = '/login';
    } catch (e) {
      window.location.href = '/login';
    }
  }
  checkAuth();

  // Mobile menu logic
  const mobileBtn = document.getElementById('mobileMenuBtn');
  const closeBtn = document.getElementById('closeMenuBtn');
  const menu = document.getElementById('mobileMenu');

  if (mobileBtn && menu && closeBtn) {
    mobileBtn.addEventListener('click', () => menu.classList.remove('hidden'));
    closeBtn.addEventListener('click', () => menu.classList.add('hidden'));
    menu.addEventListener('click', (e) => {
      if (e.target === menu) menu.classList.add('hidden');
    });
  }
</script>
